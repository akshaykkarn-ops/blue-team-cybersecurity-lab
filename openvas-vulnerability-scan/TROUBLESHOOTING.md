# ðŸ› ï¸ OpenVAS / GVM Troubleshooting & Recovery Guide

**Environment:** Kali Linux (VMware)
**Context:** Blue Team Vulnerability Management Lab
**Author:** Akshay Karn

---

## ðŸ“Œ Overview

This document captures a **real-world troubleshooting and recovery process** performed while setting up and operating **OpenVAS (Greenbone Vulnerability Manager)** in a Kali Linux lab environment.

During the setup, multiple **critical failures** were encountered including:

* Greyed-out scan configurations
* Non-functional scanners
* Database and feed initialization errors
* Disk exhaustion
* Service dependency failures

Rather than reinstalling the platform, the issues were **systematically diagnosed, resolved, and documented**, simulating a **production SOC incident response scenario**.

---

## âš ï¸ Initial Symptoms

The following issues were observed in the OpenVAS web interface and CLI:

* Scan configurations **greyed out / unavailable**
* No selectable scanner when creating tasks
* Tasks stuck at **0% progress**
* `gvmd --rebuild` failures
* Web UI accessible, but scanning impossible

---

## ðŸ” Root Cause Analysis

### 1ï¸âƒ£ Disk Space Exhaustion (Critical)

**Symptoms**

* PostgreSQL database creation failed
* Feed updates incomplete
* `gvmd` initialization errors

**Diagnosis**

```bash
df -h
```

**Finding**

* Root partition (`/`) was **100% full**
* OpenVAS feeds and PostgreSQL could not allocate required space

**Impact**

* GVM database could not initialize
* Scanner data remained incomplete
* UI showed disabled configurations

---

### 2ï¸âƒ£ GVM Dependency Chain Failure

OpenVAS relies on a strict service order:

| Service      | Purpose                |
| ------------ | ---------------------- |
| redis-server | Feed and state storage |
| ospd-openvas | Scanner daemon         |
| gvmd         | Vulnerability manager  |
| gsad         | Web interface          |

If **any service fails**, scan configuration becomes unavailable.

---

### 3ï¸âƒ£ Incomplete Feed Synchronization

Feeds detected:

* SCAP
* CERT

However:

* **NVT feed was incomplete**
* Scanner could not load vulnerability tests
* `gvmd --rebuild` failed due to missing OSP socket

---

## ðŸ› ï¸ Step-by-Step Recovery Process

---

### âœ… Step 1: Free Disk Space (Root Cause Fix)

**Action**

* Booted into Kali Live ISO
* Used **GParted** to resize partitions

**Changes**

* Increased `/` partition from ~28 GB â†’ ~52 GB
* Reduced `/home` partition accordingly

**Validation**

```bash
df -h
```

Root filesystem now had sufficient free space for feeds and database.

---

### âœ… Step 2: Stop All GVM Services

```bash
sudo systemctl stop gsad gvmd ospd-openvas redis-server
```

Ensured clean state before rebuilding.

---

### âœ… Step 3: Clean Stale Locks & Cache

```bash
sudo rm -rf /var/lib/openvas/cache/*
sudo rm -f /var/lib/gvm/feed-update.lock
```

Removed corrupted feed locks preventing updates.

---

### âœ… Step 4: Restart Core Services in Correct Order

```bash
sudo systemctl start redis-server
sudo systemctl start ospd-openvas
sudo systemctl start gvmd
sudo systemctl start gsad
```

---

### âœ… Step 5: Validate Service Health

```bash
sudo systemctl status redis-server ospd-openvas gvmd gsad
```

All services confirmed:

* **Active**
* **Running**
* No critical errors

---

### âœ… Step 6: Verify Scanner Availability

```bash
sudo -u _gvm gvmd --get-scanners
```

**Expected Result**

* OpenVAS Default Scanner listed
* Valid OSP socket: `/run/ospd/ospd.sock`

---

### âœ… Step 7: Confirm Feed Status

```bash
sudo greenbone-feed-sync --type all
```

Feeds confirmed:

* NVT
* SCAP
* CERT
* GVMD data

---

## ðŸŸ¢ Resolution Outcome

After recovery:

* Scan configurations **no longer greyed out**
* Scanner selectable in UI
* Full vulnerability scan executed successfully
* Results populated in dashboard

---

## ðŸ“Š Post-Recovery Validation

* **Task Status:** Completed
* **Findings:** 24 vulnerabilities detected
* **Severity Breakdown:**

  * Medium: SSL/TLS Weak Cipher Suites (CVSS 5.9)
  * Log-level informational findings
* **QoD:** Up to 98%

---

## ðŸ§  Lessons Learned (SOC Perspective)

### ðŸ”¹ 1. Storage Monitoring Is Critical

Vulnerability platforms are **storage-heavy**. Disk exhaustion silently breaks scanners.

### ðŸ”¹ 2. UI Issues Often Hide Backend Failures

A working web UI does **not** mean a working scanner.

### ðŸ”¹ 3. Service Order Matters

OpenVAS is **not plug-and-play**. Dependency awareness is essential.

### ðŸ”¹ 4. Logs > Reinstalling

Systematic troubleshooting avoided unnecessary reinstall and data loss.

---

## ðŸŽ¯ Why This Matters to a SOC Team

This incident mirrors **real production scenarios** where:

* Security tooling breaks mid-operation
* Analysts must restore visibility quickly
* Root cause analysis prevents repeat incidents

The ability to **recover security infrastructure** is as important as operating it.

---

## âœ… Final Status

| Component    | Status                 |
| ------------ | ---------------------- |
| Disk Space   | Resolved               |
| Feeds        | Synced                 |
| Scanner      | Operational            |
| Web UI       | Fully functional       |
| Scan Results | Generated successfully |
